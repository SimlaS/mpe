<?php

$brakiZasilenHtml = '';
$countBrakiZasilen = count($brakiZasilen);
if ($countBrakiZasilen>0){
    $naglowkiKolumn = array("Id","Data wpisu","Nazwa procesu","Tekst alarmu","Kod alarmu","Data danych","Status","Tekst komentarza","Opcje");
    $naglowkiKolumnHTML = "<tr>";
    foreach ($naglowkiKolumn as $key=>$naglowek){
        $naglowkiKolumnHTML .= "<th data-field='{$key}' data-sortable='true'>$naglowek</th>";
    }
    $naglowkiKolumnHTML .="</tr>";
    $wierszeHTML = "";
    foreach($brakiZasilen as $key => $row){
        $id = $row['ID'];
        $wierszeHTML .= "<form id='kom_$id' name='kom_$id' method='post' action='index.php'>";
        $wierszeHTML .= "<tr>";
        $wierszeHTML .= "<input type=hidden name='id' value='{$id}'>";
        $wierszeHTML .= "<td>$id</td>";
        $wierszeHTML .= "<td>{$row['DATA_WPISU']}</td>";
        $wierszeHTML .= "<td>{$row['NAZWA_PROCESU']}</td>";
        $wierszeHTML .= "<td>{$row['TEKST_ALARMU']}</td>";
        $wierszeHTML .= "<td>{$row['CODE']}</td>";
        $wierszeHTML .= "<td>{$row['DATA_DANYCH']}</td>";
        $tekstKomentarza = $row['TEKST_KOMENTARZA'];
        $status = $row['STATUS_OBSLUGI'];
        if($status=='O'){
            $statusTxt = '<em class=text-danger>do wysy³ki</em>';
            $wierszeHTML .= "<td>$statusTxt</td>";
            $poleKomentarza = "<div><textarea rows=1 type='text' name='komentarz' class='form-control' autofocus >$tekstKomentarza</textarea></div>";
            $wierszeHTML .= "<td class=col-lg-4>$poleKomentarza</td>";
            $disabled = '';
        }else{
            $statusTxt = '<em class=text-success>wys³any</em>';
            $wierszeHTML .= "<td>$statusTxt</td>";
            $wierszeHTML .= "<td><div>$tekstKomentarza</div>
                                    <div class='text-muted pull-right'>
                                        <em>{$row['KOMENTATOR']} [{$row['DATA_KOMENTARZA_TXT']}]</em>
                                    </div>
                             </td>";

            $disabled='disabled';
            
        }
        $text = "Wyœlij komentarz dla pozycji nr $id";
        $buttonsHtml = "<input type=submit class='btn btn-success' data-toggle='tooltip' title='{$text}' value='Wyœlij' $disabled >";
        $wierszeHTML .= "<td><div >$buttonsHtml</div></td>";
        $wierszeHTML .= "</tr>";
        $wierszeHTML .= "</form>";
        
    }
    $brakiZasilenHtml .= "
        <table class='table table-striped' id='brakiZasilen' data-search='false' data-toggle='table'>
            <thead>
                $naglowkiKolumnHTML
            </thead>
            <tbody>
                $wierszeHTML
            </tbody>
        </table>";
}else{
    $brakiZasilenHtml .= "Brak danych";
}

if (isset($message)){
    $messageHtml = "<div class='alert alert-success'>
                        <a href='#' class='close' data-dismiss='alert' aria-label='close'>&times;</a>
                        <strong>Dzi&eogon;kujemy! </strong> $message
                    </div>";
}else if (isset($error)){
    $messageHtml = "<div class='alert alert-danger'>
                        <a href='#' class='close' data-dismiss='alert' aria-label='close'>&times;</a>
                        <strong>B³¹d! </strong> $error
                    </div>";
}else{
    $messageHtml = '';
}

return "    
<div class='well' >
$messageHtml
    <div class='panel-group'>
      <div class='panel panel-default'>
        <div class='panel-heading' role='tab' id='headingOne'>
          <div class='panel-title'>
            <h4>Rejestr nieudanych zasileñ</h4>
          </div>
        </div>
        <div class='panel-body'>            
            $brakiZasilenHtml
        </div>
      </div>
    </div>
</div>";

