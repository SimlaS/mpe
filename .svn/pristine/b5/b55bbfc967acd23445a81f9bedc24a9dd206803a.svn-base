<?php
include_once "models/Table.class.php";
class Mpe_Rejestr_Zasilen_Table extends Table{
    
    public function getAllNotCompleted(){
        $this->db->q("SELECT
                        MRZ.ID                     ,
                        MRZ.DATA_WPISU             ,
                        MRZ.ID_PROCESU             ,
                        MRZ.NAZWA_PROCESU          ,
                        MRZ.TEKST_ALARMU           ,
                        MRZ.DATA_DANYCH            ,
                        MRZ.STATUS_OBSLUGI         ,
                        MRZ.CODE                   ,
                        MRZ.TEKST_KOMENTARZA       
                      FROM
                        MPE_REJESTR_ZASILEN MRZ
                      WHERE 1=1
                        --AND MRZ.STATUS_OBSLUGI ='O'
                        AND MRZ.CODE <> 0
                    ");
        return $this->db->ret();
    }
//    public function getAllAwaiting(){
//        $this->db->q("SELECT * FROM skip_zadania  WHERE status is null or status <> 1");
//        return $this->db->ret();
//    }
//    public function insertNewTasks($frazydlagoogle,$wzorce,$adresy,$zakresy,$strony,$nrumow,$windykatorzy,$nazwiskaklientow,$peseleregony){
//        $i = 1;
//        foreach ($frazydlagoogle as $key => $frazadlagoogle) {
//            if(!empty($frazadlagoogle)){
//                $frazadlagoogle = urlencode($frazadlagoogle);
//                $wzorzec = urlencode($wzorce[$key]);
//                $adres = urlencode($adresy[$key]);
//                $zakres = (int) $zakresy[$key];
//                $strona = (int) $strony[$key];
//                $szukajMiasta = $_POST['szukajMiasta'][$key];
//                $szukajTelefonu = $_POST['szukajTelefonu'][$key];
//                $szukajAdresu = $_POST['szukajAdresu'][$key];
//                $nrumowy = $nrumow[$key];
//                $windykator = urlencode($windykatorzy[$key]);
//                $nazwiskoklienta = urlencode($nazwiskaklientow[$key]);
//                $peselregon = $peseleregony[$key];
//                $taskNumber = date('Ymd').sprintf("%'.03d", $i);               
//                $this->db->q("INSERT INTO skip_zadania(DATA_ZADANIA,SZUKANENAZWISKO,SZUKAJTELEFONU,SZUKAJADRESU,SZUKAJMIASTA,SZUKANEMIASTO,LICZBASTRON,ZAKRESZNAKOW,NRZADANIA,FRAZADLAGOOGLE,NRUMOWY,WINDYKATOR,NAZWISKOKLIENTA,PESELREGON)
//                              VALUES(SYSDATE,'{$wzorzec}','{$szukajTelefonu}','{$szukajAdresu}','{$szukajMiasta}','{$adres}',{$strona},{$zakres},'{$taskNumber}','{$frazadlagoogle}','{$nrumowy}','{$windykator}','{$nazwiskoklienta}','{$peselregon}')");
//                
//                $i++;
//            }
//        }
//        $this->db->commit();
//    }
//
//    public function deleteAllAwaiting(){
//        $this->db->q("Delete FROM skip_zadania  WHERE status is null or status <> 1");
//        $this->db->commit();
//    }
    public function updateComment($id,$komentarz){
        $this->db->q("Update MPE_REJESTR_ZASILEN 
                set TEKST_KOMENTARZA = '{$komentarz}',STATUS_OBSLUGI = 'Z'
                        WHERE 1=1
                        AND ID = {$id}");
        $this->db->commit();
    }
}
